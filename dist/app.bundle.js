"use strict";(self.webpackChunkthe_last_word=self.webpackChunkthe_last_word||[]).push([[143],{132:(t,e,r)=>{const o=15,i=7,n=7,l=7,s=50;var a;!function(t){t.English="English",t.Hebrew="Hebrew"}(a||(a={}));const c=a.Hebrew,d={[a.Hebrew]:[{letter:"א",count:9,points:1},{letter:"ב",count:2,points:2},{letter:"ג",count:3,points:1},{letter:"ד",count:3,points:1},{letter:"ה",count:2,points:2},{letter:"ו",count:4,points:1},{letter:"ז",count:1,points:1},{letter:"ח",count:2,points:3},{letter:"ט",count:1,points:2},{letter:"י",count:4,points:1},{letter:"כ",count:3,points:3},{letter:"ל",count:4,points:1},{letter:"מ",count:3,points:2},{letter:"נ",count:5,points:1},{letter:"ס",count:7,points:1},{letter:"ע",count:5,points:1},{letter:"פ",count:3,points:2},{letter:"צ",count:1,points:4},{letter:"ק",count:1,points:5},{letter:"ר",count:4,points:1},{letter:"ש",count:4,points:2},{letter:"ת",count:4,points:2}],[a.English]:[{letter:"A",count:9,points:1},{letter:"B",count:2,points:3},{letter:"C",count:2,points:3},{letter:"D",count:4,points:2},{letter:"E",count:12,points:1},{letter:"F",count:2,points:4},{letter:"G",count:3,points:2},{letter:"H",count:2,points:4},{letter:"I",count:9,points:1},{letter:"J",count:1,points:8},{letter:"K",count:1,points:5},{letter:"L",count:4,points:1},{letter:"M",count:2,points:3},{letter:"N",count:6,points:1},{letter:"O",count:8,points:1},{letter:"P",count:2,points:3},{letter:"Q",count:1,points:10},{letter:"R",count:6,points:1},{letter:"S",count:4,points:1},{letter:"T",count:6,points:1},{letter:"U",count:4,points:1},{letter:"V",count:2,points:4},{letter:"W",count:2,points:4},{letter:"X",count:1,points:8},{letter:"Y",count:2,points:4},{letter:"Z",count:1,points:10}]};var u;!function(t){t.Regular="Regular",t.DoubleWord="DoubleWord",t.DoubleLetter="DoubleLetter",t.TripleWord="TripleWord",t.TripleLetter="TripleLetter",t.CenterTile="CenterTile"}(u||(u={}));const h={[u.DoubleWord]:{wordMul:2,letterMul:1,coordinates:[{row:1,col:1},{row:2,col:2},{row:3,col:3},{row:4,col:4},{row:10,col:10},{row:11,col:11},{row:12,col:12},{row:13,col:13},{row:1,col:13},{row:2,col:12},{row:3,col:11},{row:4,col:10},{row:10,col:4},{row:11,col:3},{row:12,col:2},{row:13,col:1}]},[u.DoubleLetter]:{wordMul:1,letterMul:2,coordinates:[{row:0,col:3},{row:0,col:11},{row:2,col:6},{row:2,col:8},{row:3,col:0},{row:3,col:7},{row:3,col:14},{row:6,col:2},{row:6,col:6},{row:6,col:8},{row:6,col:12},{row:7,col:3},{row:7,col:11},{row:8,col:2},{row:8,col:6},{row:8,col:8},{row:8,col:12},{row:11,col:0},{row:11,col:7},{row:11,col:14},{row:12,col:6},{row:12,col:8},{row:14,col:3},{row:14,col:11}]},[u.TripleWord]:{wordMul:3,letterMul:1,coordinates:[{row:0,col:0},{row:0,col:7},{row:0,col:14},{row:7,col:0},{row:7,col:14},{row:14,col:0},{row:14,col:7},{row:14,col:14}]},[u.TripleLetter]:{wordMul:1,letterMul:3,coordinates:[{row:1,col:5},{row:1,col:9},{row:5,col:1},{row:5,col:5},{row:5,col:9},{row:5,col:13},{row:9,col:1},{row:9,col:5},{row:9,col:9},{row:9,col:13},{row:13,col:5},{row:13,col:9}]},[u.Regular]:{wordMul:1,letterMul:1,coordinates:[]},[u.CenterTile]:{wordMul:2,letterMul:1,coordinates:[{row:n,col:l}]}};var p;!function(t){t[t.EndTurn=0]="EndTurn"}(p||(p={}));const w={[a.English]:{[p.EndTurn]:"End Turn"},[a.Hebrew]:{[p.EndTurn]:"סיום תור"}};class f{constructor(t,e){this._row=t,this._col=e,this._tile=null,this._type=u.Regular,this._wordMul=1,this._letterMul=1}get row(){return this._row}get col(){return this._col}get tile(){return this._tile}set tile(t){this._tile=t}get type(){return this._type}set type(t){this._type=t}get wordMultiplier(){return this._wordMul}set wordMultiplier(t){this._wordMul=t}get letterMultiplier(){return this._letterMul}set letterMultiplier(t){this._letterMul=t}disableMultiplier(){this._wordMul=1,this._letterMul=1}}class g{constructor(t){this._size=t,this.tiles=new Array(t).fill(null).map((()=>new Array(t).fill(null)));for(let e=0;e<t;e++)for(let r=0;r<t;r++)this.tiles[e][r]=new f(e,r);Object.keys(h).forEach(((t,e)=>{let r=t,o=h[r].wordMul,i=h[r].letterMul;h[r].coordinates.forEach((t=>{this.tiles[t.row][t.col].type=r,this.tiles[t.row][t.col].wordMultiplier=o,this.tiles[t.row][t.col].letterMultiplier=i}))}))}getBoardTile(t,e){return this.tiles[t][e]}getTile(t,e){return this.tiles[t][e].tile}setTile(t,e,r){this.tiles[t][e].tile=r}isTileEmpty(t,e){return null==this.getTile(t,e)}isTileInBoard(t,e){return t>=0&&e>=0&&t<this.height&&e<this.width}get width(){return this._size}get height(){return this._size}}class y{constructor(t,e,r){this._name=t,this._id=e,this.max_tile_num=r,this._points=0,this._rack=new Set}fillRack(t){for(;this._rack.size<this.max_tile_num&&t.length>0;)this._rack.add(t.draw())}removeTile(t){this._rack.delete(t)}get rack(){return[...this._rack]}get id(){return this._id}get name(){return this._name}get points(){return this._points}set points(t){if(t<0)throw"Points must be non-negative";this._points=t}}let m=0;class v{constructor(t,e){this._letter=t,this._points=e,this._id=m++}get letter(){return this._letter}get points(){return this._points}get id(){return this._id}}class b{constructor(t){this.tiles=[];const e=d[t];for(const t of e)for(let e=t.count;e>0;e--)this.tiles.push(new v(t.letter,t.points));this.tiles=function(t){let e,r=t.length;for(;0!=r;)e=Math.floor(Math.random()*r),r--,[t[r],t[e]]=[t[e],t[r]];return t}(this.tiles)}draw(){return this.tiles.length>0?this.tiles.pop():null}get length(){return this.tiles.length}}class _{constructor(t,e){this.board=document.getElementById("board"),this.activeTiles=new Map,this.callbacks=e,this.createBoard(t)}show(){document.getElementById("game").classList.remove("hide"),document.getElementById("loader").remove()}createBoard(t){this.board.innerHTML="";for(let e=0;e<t.height;e++)for(let r=0;r<t.width;r++){const o=document.createElement("div");o.classList.add("board_tile"),o.dataset.r=e.toString(),o.dataset.c=r.toString(),o.classList.add(`tile_type_${t.getBoardTile(e,r).type}`),this.board.appendChild(o)}this.attachEvents()}attachEvents(){this.makeBoardDroppable(),this.makeElementDroppable(document.getElementById("active_player_rack")),this.configureButtons()}configureButtons(){const t=document.getElementById("end_turn_button"),e=this;var r,o,i;t.innerText=(r=c,o=p.EndTurn,(null===(i=w[r])||void 0===i?void 0:i[o])||""),t.addEventListener("click",(function(t){const r=[];document.querySelectorAll(".active_tile").forEach((t=>{const o=t.parentElement;if(null==o?void 0:o.classList.contains("board_tile")){const i=parseInt(t.id.replace("game_tile_",""));r.push({tile:e.activeTiles.get(i),r:parseInt(o.dataset.r),c:parseInt(o.dataset.c)})}})),e.callbacks.endTurn(r)}))}finalizePlacements(){document.querySelectorAll(".active_tile").forEach((t=>{t.classList.remove("active_tile"),t.classList.remove("grabbable"),t.setAttribute("draggable","false")}))}makeElementDroppable(t){t.classList.add("droppable"),t.addEventListener("dragenter",(function(t){const e=t.target;null!=e.classList&&(t.preventDefault(),e.classList.add("drag-over"))})),t.addEventListener("dragover",(function(t){const e=t.target;null!=e.classList&&(t.preventDefault(),e.classList.add("drag-over"))})),t.addEventListener("dragleave",(function(t){const e=t.target;null!=e.classList&&(t.preventDefault(),e.classList.remove("drag-over"))})),t.addEventListener("drop",(function(t){const e=t.target,r=t;if(null==e.classList)return;if(e.classList.remove("drag-over"),!e.classList.contains("droppable"))return;if(null==r.dataTransfer)return;const o=r.dataTransfer.getData("text/plain"),i=document.getElementById(o);null!=i&&(e.appendChild(i),i.classList.remove("hide"))}))}makeBoardDroppable(){document.querySelectorAll(".board_tile").forEach((t=>{this.makeElementDroppable(t)}))}createTile(t,e,r){const o=document.createElement("div"),i=document.createTextNode(t.letter);o.classList.add("game_tile"),e&&(o.classList.add("grabbable"),o.setAttribute("draggable","true"),o.addEventListener("dragstart",(function(t){const e=t.target,r=t;null!=e.classList&&(null!=r.dataTransfer&&r.dataTransfer.setData("text/plain",e.id),setTimeout((()=>{e.classList.add("hide")}),0))})),o.addEventListener("dragend",(function(t){const e=t.target;null!=e.classList&&e.classList.remove("hide")}))),r&&o.classList.add("active_tile"),o.appendChild(i),o.setAttribute("id",`game_tile_${t.id}`);const n=document.createElement("div"),l=document.createTextNode(t.points.toString());return n.classList.add("points"),n.appendChild(l),o.appendChild(n),o}displayPlayerInfo(t){const e=document.getElementById(`player${t.id}_rack`);if(null==e)throw new Error(`Can't find player rack for player ${t.id}`);e.innerHTML="",t.rack.forEach((t=>{e.appendChild(this.createTile(t,!1,!1))}));const r=document.getElementById(`player${t.id}_points`);if(null==r)throw new Error(`Can't find player points for player ${t.id}`);r.innerText=t.points.toString()}setActivePlayer(t){const e=document.getElementById(`player${t.id}_rack`),r=document.getElementById("active_player_rack");if(null==e||null==r)throw new Error("Can't find rack!");r.innerHTML="",this.activeTiles.clear(),t.rack.forEach((t=>{var e;null===(e=document.getElementById(`game_tile_${t.id}`))||void 0===e||e.remove(),r.appendChild(this.createTile(t,!0,!0)),this.activeTiles.set(t.id,t)}))}logMoveDetails(t,e,r){}}var T=r(701),E=function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function l(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(l,s)}a((o=o.apply(t,e||[])).next())}))};class M{constructor(t){this.language=t,this.dawg=null,this.translateMapping={"":""}}init(){return E(this,void 0,void 0,(function*(){let t=yield fetch("wordlists/config.json");const e=yield t.json();if(this.translateMapping=e.translate_mapping,t=yield fetch("wordlists/hspell/e.dawg"),!t.ok)throw 404==t.status&&console.log("Can't find database"),new Error(`An error has occurred while loading the dictionary: ${t.status}`);let r=yield t.arrayBuffer();this.dawg=new T.$;let o=performance.now();this.dawg.load(r);let i=performance.now();console.log(`Loaded DAWG database in ${i-o} milliseconds`)}))}heb2eng(t){return t.replace(/(\?|[\u0590-\u05fe])/g,(t=>this.translateMapping[t]))}contains(t){if(null==this.dawg)throw new Error("Dictionary must be loaded before using it");return this.dawg.contains(this.heb2eng(t)+"\r")}}var L=function(t,e,r,o){return new(r||(r=Promise))((function(i,n){function l(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(l,s)}a((o=o.apply(t,e||[])).next())}))};const k=new class{constructor(t){const e=this;this.board=new g(o),this.players=t.map(((t,e)=>new y(t,e+1,i))),this.currentPlayerIndex=0,this.bag=new b(c),this.firstTurnPlayed=!1,this.dictionary=new M(c),this.display=new _(this.board,{endTurn:function(t){e.endTurnCallback(t)}}),this.players.forEach((t=>{t.fillRack(this.bag),this.display.displayPlayerInfo(t)}))}init(){return L(this,void 0,void 0,(function*(){yield this.dictionary.init(),this.display.setActivePlayer(this.currentPlayer)}))}start(){this.display.show()}getCreatedWords(t){const e=new Set,r=["r","c"];for(const o of t)for(let t of r){let r="",i=0,n={r:-1,c:-1},l={r:o.r,c:o.c};for(;this.board.isTileInBoard(l.r,l.c)&&!this.board.isTileEmpty(l.r,l.c);)n={r:l.r,c:l.c},l[t]--;l.r=n.r,l.c=n.c;let s=1;for(;this.board.isTileInBoard(l.r,l.c)&&!this.board.isTileEmpty(l.r,l.c);){let e=this.board.getTile(l.r,l.c),o=this.board.getBoardTile(l.r,l.c);r+=e.letter,i+=e.points*o.letterMultiplier,l[t]++,s*=o.wordMultiplier}i*=s,r.length>1&&e.add(JSON.stringify({word:r,start_index:n,points:i}))}return Array.from(e,(t=>JSON.parse(t)))}calculatePoints(t,e){let r=0;for(const t of e)console.log(t.word,t.points),r+=t.points;return t.length==i&&(r+=s),r}verifyPlacementConsecutive(t){if(t.length>0){const e=t.map((t=>t.r)),r=t.map((t=>t.c));if(1!==new Set(e).size&&1!==new Set(r).size)return!1}return!0}verifyPlacementConnected(t){if(this.firstTurnPlayed&&t.length>0){let e=!1;for(const r of t)for(const[t,o]of[[1,0],[-1,0],[0,1],[0,-1]]){let i=r.r+t,n=r.c+o;if(this.board.isTileInBoard(i,n)&&!this.board.isTileEmpty(i,n)){e=!0;break}}if(!e)return!1}return!0}endTurnCallback(t){const e=[];try{if(!this.verifyPlacementConsecutive(t))throw"The tiles are not placed consecutively horizontally or vertically";if(!this.verifyPlacementConnected(t))throw"One or more tiles are not connected to an existing tile";for(const r of t){if(!this.board.isTileEmpty(r.r,r.c))throw"One or more tiles are placed on an existing tile.";this.board.setTile(r.r,r.c,r.tile),e.push(r)}const r=this.getCreatedWords(t);for(const t of r)if(!this.dictionary.contains(t.word))throw`Illegal word: ${t.word}`;if(!this.firstTurnPlayed){if(1==t.length)throw"The first word must be at least 2 letters long!";if(t.length>0){let e=!1;if(t.forEach((t=>{t.r==n&&t.c==l&&(e=!0)})),!e)throw"The first word must be placed on the center tile!";this.firstTurnPlayed=!0}}let o=this.calculatePoints(t,r);this.currentPlayer.points+=o,t.forEach((t=>{this.currentPlayer.removeTile(t.tile),this.board.getBoardTile(t.r,t.c).disableMultiplier()})),this.display.finalizePlacements(),this.display.logMoveDetails(this.currentPlayer,o,r),this.currentPlayer.fillRack(this.bag),this.display.displayPlayerInfo(this.currentPlayer),this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.players.length,this.display.setActivePlayer(this.currentPlayer)}catch(t){console.log(t),e.forEach((t=>{this.board.setTile(t.r,t.c,null)}))}}get currentPlayer(){return this.players[this.currentPlayerIndex]}getBoard(){return this.board}}(["שחקן/ית א'","שחקן/ית ב'"]);k.init(),k.start()}},t=>{t.O(0,[4],(()=>{return e=132,t(t.s=e);var e}));t.O()}]);